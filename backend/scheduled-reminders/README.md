# Автоматические Push-напоминания

Эта функция проверяет важные события и отправляет push-уведомления пользователям.

## Что проверяется

- **Важные даты**: дни рождения, годовщины (за 1 день)
- **События календаря**: предстоящие события на сегодня и завтра
- **Лекарства**: напоминания о приёме медикаментов (за 30 минут)

## Ручной запуск

Функция доступна по URL и может быть вызвана вручную:

```bash
curl https://functions.poehali.dev/1b065d31-c535-44ca-ad19-36658де8235e
```

Или через интерфейс: **Настройки → Уведомления → Проверить напоминания сейчас**

## Автоматический запуск по расписанию

### Вариант 1: Яндекс Cloud Triggers (рекомендуется)

1. Откройте [Яндекс Cloud Console](https://console.cloud.yandex.ru/)
2. Перейдите в **Cloud Functions → Triggers**
3. Нажмите **Создать триггер**
4. Выберите тип: **Timer**
5. Укажите расписание (cron):
   - `0 9 * * *` — каждый день в 9:00
   - `0 9,14,19 * * *` — 3 раза в день (9:00, 14:00, 19:00)
6. Укажите URL функции: `https://functions.poehali.dev/1b065d31-c535-44ca-ad19-36658de8235e`
7. Сохраните триггер

### Вариант 2: Cron-job сервисы

Используйте бесплатные сервисы для автоматических HTTP-запросов:

**cron-job.org** (бесплатно):
1. Зарегистрируйтесь на [cron-job.org](https://cron-job.org/)
2. Создайте новый Cron Job
3. URL: `https://functions.poehali.dev/1b065d31-c535-44ca-ad19-36658de8235e`
4. Расписание: `0 9,14,19 * * *`
5. Метод: GET
6. Сохраните

**EasyCron** (бесплатно):
1. Зарегистрируйтесь на [easycron.com](https://www.easycron.com/)
2. Создайте новый Cron Job
3. URL: `https://functions.poehali.dev/1b065d31-c535-44ca-ad19-36658de8235e`
4. Интервал: выберите нужное время
5. Сохраните

### Вариант 3: GitHub Actions (для GitHub-интеграции)

Создайте файл `.github/workflows/scheduled-reminders.yml`:

```yaml
name: Scheduled Reminders

on:
  schedule:
    - cron: '0 9,14,19 * * *'  # Runs at 9:00, 14:00, 19:00 UTC daily
  workflow_dispatch:  # Allow manual trigger

jobs:
  send-reminders:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Reminders
        run: |
          curl -X GET https://functions.poehali.dev/1b065d31-c535-44ca-ad19-36658de8235e
```

## Логирование

Проверить работу функции можно через логи:
- В poehali.dev: **Logs → Backend → scheduled-reminders**
- Или через Яндекс Cloud Console

## Требования

- Секрет `VAPID_PRIVATE_KEY` должен быть настроен
- Секрет `DATABASE_URL` для доступа к базе данных
- У семьи должна быть активная push-подписка

## Проверка работы

После настройки автозапуска:
1. Создайте событие на завтра в календаре
2. Дождитесь времени выполнения cron
3. Проверьте push-уведомление на устройстве
4. Проверьте логи функции

## Отладка

Если уведомления не приходят:
1. Проверьте логи функции
2. Убедитесь, что VAPID ключи корректны
3. Проверьте наличие push-подписки в таблице `push_subscriptions`
4. Попробуйте ручной запуск через интерфейс
